# 前后端集成测试指南

## 环境准备

### 后端启动
```powershell
cd F:\campus-moments\backend
node app.js
# 或
npm start
```
后端应该运行在 `http://localhost:3000`

### 前端启动（HBuilderX）
1. 打开 HBuilderX
2. 打开项目：`F:\campus-moments\frontend\FEProject`
3. 确保在 `dev` 分支
4. 点击「运行」→「在浏览器中运行」（H5 模式）
   或「运行」→「小程序模拟器」（微信/支付宝）

## 完整业务流程测试

### 1. 注册流程
**页面：** `/pages/register/register`

操作步骤：
- 输入用户名（如 `testuser123`）
- 输入手机号（如 `13800138000`）
- 输入密码（如 `password123`）
- 点击「注册」按钮

预期结果：
- 后端调用 `POST /api/auth/register`
- 注册成功后自动跳转到登录页面
- 显示 toast 提示"注册成功"

---

### 2. 登录流程
**页面：** `/pages/login/login`

操作步骤：
- 输入账号（用户名或手机号）
- 输入密码
- 点击「登录」按钮

预期结果：
- 后端调用 `POST /api/auth/login`
- 登录成功，获得 JWT token 并保存到 localStorage
- 自动跳转到首页（home 页面）
- 显示 toast 提示"登录成功"

---

### 3. 首页动态流（核心功能）
**页面：** `/pages/home/home`

操作步骤：
- 首页自动加载
- 等待列表加载完成

预期结果：
- 页面加载时自动调用 `GET /api/posts`
- 后端返回所有动态列表（POST 请求返回 posts 数据）
- 页面动态渲染 posts 列表（v-for 循环显示每条动态）
- 每条动态显示：
  - 标题/内容
  - 用户名
  - 创建时间
  - 点赞数

---

### 4. 发布动态流
**页面：** `/pages/issue/issue`（底部导航栏 Tab）

操作步骤：
1. 点击底部导航栏的发布按钮进入发布页面
2. 填写动态内容（必填）
3. 选择标签（可选）
4. 点击「发布」按钮

预期结果：
- 调用 `POST /api/posts` 发送内容、标签、可见性信息
- 后端返回完整的 post 对象（包含 postId、content、createdAt 等）
- 发布成功后显示 toast 提示"发布成功"
- 自动返回首页，列表刷新显示新发布的动态

---

### 5. 用户资料页
**页面：** `/pages/my/my`（底部导航栏最右侧 Tab）

操作步骤：
1. 进入「我的」页面
2. 页面加载

预期结果：
- 调用 `GET /api/user/profile` 获取用户信息
- 显示用户名、手机号
- 可以点击「修改密码」或「退出登录」

---

### 6. 修改密码流
**页面：** `/pages/modify-password/modify-password`

操作步骤：
1. 从「我的」页面点击「修改密码」
2. 输入旧密码
3. 输入新密码
4. 确认新密码
5. 点击「修改」按钮

预期结果：
- 验证两次新密码是否一致
- 调用 `PUT /api/user/password` 发送旧密码和新密码
- 修改成功后显示 toast 提示"密码修改成功"
- 自动返回我的页面

---

### 7. 退出登录
**页面：** `/pages/my/my`

操作步骤：
1. 在「我的」页面点击「退出登录」按钮
2. 确认退出

预期结果：
- 弹出确认弹窗
- 点击确认后清除 token 和用户信息
- 自动跳转到登录页面

---

## API 集成情况总结

| 页面 | 功能 | API 端点 | 状态 |
|------|------|---------|------|
| login | 用户登录 | `POST /api/auth/login` | ✅ 已集成 |
| register | 用户注册 | `POST /api/auth/register` | ✅ 已集成 |
| home | 获取动态列表 | `GET /api/posts` | ✅ 已集成 |
| issue | 发布动态 | `POST /api/posts` | ✅ 已集成 |
| my | 获取用户资料 | `GET /api/user/profile` | ✅ 已集成 |
| modify-password | 修改密码 | `PUT /api/user/password` | ✅ 已集成 |

---

## 故障排查

### 问题 1：前端无法连接后端
**症状：** 发出 API 请求但收不到响应，或显示网络错误

**检查清单：**
- [ ] 后端是否运行中？运行 `node app.js` 检查
- [ ] 后端是否运行在 localhost:3000？
- [ ] 前端 API 配置是否正确？检查 `src/api.js` 中的 baseURL
- [ ] 是否有 CORS 问题？后端应该有 `cors()` 中间件

### 问题 2：登录后仍无法访问需要认证的页面
**症状：** 登录成功但请求受保护的 API 时返回 401

**检查清单：**
- [ ] Token 是否正确保存？检查浏览器开发者工具 → Application → LocalStorage
- [ ] Token 格式是否正确？应该是 "Bearer xxx" 格式
- [ ] 后端是否设置了 auth 中间件？检查 `backend/middleware/auth.js`

### 问题 3：发布动态失败
**症状：** 发布按钮点击后没有反应或显示错误

**检查清单：**
- [ ] 内容是否为空？内容是必填项
- [ ] 是否已登录？发布需要身份验证
- [ ] 后端是否处理了 `POST /api/posts` 请求？

### 问题 4：首页列表为空或不显示数据
**症状：** 首页显示"暂无动态"或列表不更新

**检查清单：**
- [ ] 后端数据库中是否有 posts 数据？运行 SQL 查询检查
- [ ] `GET /api/posts` 返回的数据结构是否正确？
- [ ] 前端 `loadPosts()` 方法是否正确调用？检查浏览器控制台日志

---

## 性能和优化建议

1. **加载优化**
   - 在 `GET /api/posts` 中实现分页
   - 前端实现无限滚动加载

2. **图片优化**
   - 实现图片上传到后端 `/upload/file`
   - 存储图片 URL 到数据库，首页动态显示图片

3. **缓存优化**
   - 在本地缓存用户信息和动态列表
   - 下拉刷新时重新加载

---

## 完整业务流程测试脚本

想要一键测试整个流程，可以参考后端的 `scripts/test-endpoints.js` 文件，
该脚本演示了完整的注册→登录→获取资料→发布→修改密码流程。

运行命令：
```powershell
cd F:\campus-moments\backend
node scripts/test-endpoints.js
```

此脚本用于验证后端所有 API 的正确性。前端集成后，可通过手动操作页面进行 E2E 测试。
