# 🚀 快速启动指南

## 准备工作（首次运行）

### 后端环境检查
```powershell
cd F:\campus-moments\backend

# 1. 检查依赖是否已安装
dir node_modules

# 如果没有，安装依赖
npm install

# 2. 检查 .env 文件是否存在并包含数据库配置
type .env
# 应该包含：DB_HOST, DB_USER, DB_PASSWORD, DB_NAME, JWT_SECRET

# 3. 确认数据库表已创建（运行初始化脚本）
# 参考 db 目录中的 SQL 文件或运行：
# node db/init.js (如果存在的话)
```

### 前端环境检查
```powershell
cd F:\campus-moments\frontend\FEProject

# 1. 切换到 dev 分支
git checkout dev

# 2. 检查依赖
dir node_modules

# 如果没有，安装依赖
npm install
```

---

## 🎬 启动步骤

### 步骤 1：启动后端（一个 PowerShell 窗口）
```powershell
cd F:\campus-moments\backend
node app.js
```

**预期输出：**
```
Server is running on port 3000
Database connected successfully to campus_moments
```

### 步骤 2：启动前端（在 HBuilderX 中）
1. 打开 HBuilderX
2. 打开项目：`F:\campus-moments\frontend\FEProject`
3. 确保在 `dev` 分支
4. 按 `F5` 或点击菜单「运行」→「在浏览器中运行」

**预期效果：**
- 浏览器自动打开 H5 版本
- 显示登录页面

---

## ✅ 快速验证清单

运行以下测试来验证集成是否成功：

### 测试 1：后端 API 自动化测试（推荐首先运行）
```powershell
cd F:\campus-moments\backend
node scripts/test-endpoints.js
```

**预期结果：**
```
✓ POST /api/auth/register - 注册成功
✓ POST /api/auth/login - 登录成功
✓ GET /api/user/profile - 获取资料成功
✓ GET /api/posts - 获取动态列表成功
✓ POST /api/posts - 发布动态成功
✓ PUT /api/user/password - 修改密码成功
...
所有测试通过!
```

### 测试 2：前端 UI 完整流程测试
在浏览器中按以下步骤操作：

#### 2.1 注册新用户
- 页面：http://localhost:5173 或 HBuilderX 生成的地址
- 点击"没有账号？去注册"
- 填写注册信息并注册

#### 2.2 登录
- 用注册的账号密码登录
- **应该能看到首页**

#### 2.3 查看动态列表
- 自动加载首页
- **应该显示动态列表**（如果先前发布过）

#### 2.4 发布新动态
- 点击底部导航栏的"+"按钮
- 填写内容并发布
- **返回首页，应该显示新发布的动态**

#### 2.5 查看个人资料
- 点击底部导航栏"我的"
- **应该显示登录用户的用户名和手机号**

#### 2.6 修改密码
- 点击"修改密码"按钮
- 填写旧密码和新密码
- **提示修改成功**

#### 2.7 退出登录
- 点击"退出登录"
- 确认后返回登录页

---

## 📝 重要文件位置

### 配置文件
- 后端配置：`backend/.env` - 数据库和 JWT 配置
- 前端 API 配置：`frontend/FEProject/src/api.js` - baseURL 配置

### 源代码
- 后端路由：`backend/routes/` - auth.js, posts.js, user.js, upload.js
- 后端中间件：`backend/middleware/auth.js` - JWT 认证
- 前端页面：`frontend/FEProject/pages/` - 所有 UI 页面
- 前端 API 客户端：`frontend/FEProject/src/api.js`

### 文档
- 详细集成指南：`集成测试指南.md`
- 完整总结：`前后端集成完成总结.md`
- 此文件：`快速启动指南.md`

---

## 🔧 故障排查

### 问题：后端启动失败
```
Error: connect ECONNREFUSED
```
**解决**：数据库连接失败
1. 检查 MySQL 服务是否运行
2. 检查 .env 中的数据库配置是否正确
3. 确认可以连接到 106.52.165.122:3306

### 问题：前端 API 请求超时
**解决**：
1. 确认后端运行在 localhost:3000
2. 检查浏览器控制台的网络请求
3. 查看 src/api.js 中的 baseURL

### 问题：登录后仍然是 401
**解决**：
1. 清除浏览器 localStorage
2. 重新登录
3. 检查 token 是否正确保存

---

## 💡 快速 Tips

### 调试模式
打开浏览器开发者工具（F12）查看：
- **Console 标签**：API 错误日志
- **Network 标签**：HTTP 请求详情
- **Application 标签**：localStorage 中的 token

### 数据库查询
直接查询数据库中的数据：
```sql
-- 查看所有用户
SELECT * FROM users;

-- 查看所有动态
SELECT * FROM posts;

-- 查看最新动态
SELECT * FROM posts ORDER BY created_at DESC LIMIT 10;
```

### 重置数据库
如果需要清空数据重新开始：
```powershell
# 检查 db 文件夹中的 SQL 文件
cd F:\campus-moments\backend\db
# 使用 MySQL 客户端重新运行初始化脚本
```

---

## 📊 预期架构

```
前端 (H5 / uni-app)
    ↓ (Axios HTTP)
后端 (Node.js + Express)
    ↓ (SQL)
数据库 (MySQL 云服务器)
```

---

## ✨ 已实现的 API 列表

| 路由 | 方法 | 功能 | 认证 |
|------|------|------|------|
| /api/health | GET | 健康检查 | 否 |
| /api/auth/register | POST | 用户注册 | 否 |
| /api/auth/login | POST | 用户登录 | 否 |
| /api/auth/logout | POST | 用户登出 | 是 |
| /api/posts | GET | 获取动态列表 | 否 |
| /api/posts | POST | 发布新动态 | 是 |
| /api/posts/:id | GET | 获取单条动态 | 否 |
| /api/posts/:id | PUT | 编辑动态 | 是 |
| /api/posts/:id | DELETE | 删除动态 | 是 |
| /api/user/profile | GET | 获取用户资料 | 是 |
| /api/user/password | PUT | 修改密码 | 是 |
| /api/upload/file | POST | 上传文件 | 是 |

---

## 🎯 下一步

1. ✅ 运行后端自动化测试 → 验证 API
2. ✅ 启动前端 → 打开浏览器
3. ✅ 完整流程测试 → 注册、登录、发布、修改密码
4. 📱 （可选）在微信开发者工具中测试小程序版本
5. 🚀 （可选）部署到云服务器

---

**一切准备就绪！现在就开始测试吧！** 🎉
